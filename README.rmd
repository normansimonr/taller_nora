---
title: "Taller"
author: "Norman Simón Rodríguez"
date: "23 de octubre de 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval=F)
```


## Preliminares

Vamos a cargar nuestros datos (son datos creados a través de una simulación). Debemos definir el tamaño de la muestra:

```{r}
n <- 10000
source("creador_datos.R")
```

Y ahora vamos a crear una función para hacer que pase el tiempo sobre los datos (un año a la vez). La función se llamar `pasartiempo()`:

```{r}
source("pasartiempo_def.R")
```

Pasamos unos años:

```{r}
T1 <- pasartiempo(T0)
T2 <- pasartiempo(T1)
```

Notemos que hasta este momento no hemos implementado ninguna intervención (curso de finanzas). Miremos la distribución de ingresos en cada tiempo.

```{r}
dT0 <- density(T0$ingresos)
dT1 <- density(T1$ingresos)
dT2 <- density(T2$ingresos)

plot(dT0, main="Ingresos sin intervención", xlab="Pesos per cápita", ylim=range(dT0$y, dT1$y, dT2$y), 
     xlim=range(dT0$x, dT1$x, dT2$x)/5, 
     lwd=3, col="black")
  abline(v=mean(T0$ingresos), lwd=3, col="black")

  lines(dT1, lwd=3, col="red")
    abline(v=mean(T1$ingresos), lwd=3, col="red")
  lines(dT2, lwd=3, col="blue")
    abline(v=mean(T2$ingresos), lwd=3, col="blue")
```


Las medias son:
```{r}
medias <- c(mean(T0$ingresos), mean(T1$ingresos), mean(T2$ingresos))
medias <- rbind(c("T0", "T1", "T2"), medias)
```

## Muestreo aleatorio

El muestreo aleatorio es fácil de hacer. Sólo usamos la función `sample()`:

```{r}
muestraid <- sample(T0$id, size=n/10, replace=F)
muestraT0 <- subset(T0, T0$id %in% muestraid)
muestraT1 <- subset(T1, T1$id %in% muestraid)
muestraT2 <- subset(T2, T2$id %in% muestraid)
```

La tabla de balance

```{r}
apply(T0, 2, mean)-apply(muestraT0, 2, mean)
```



# Una RCT (asignación aleatoria)

El primer paso para 

## La verdad

La notación es la siguiente:
$$
Y=ingreso\\
X_1=ocupado\\
X_2=anioseduc\\
X_3=salariounitario \, (promedio\, del\, mercado)\\
X_4=conexiones\\
X_5=sexo\\
X_6=nivelingles
X_7=estadosalud\\
X_8=empresario\\
X_9=marginpropS\\
X_{10}=costoeduc \, (promedio\, del\, mercado)\\
X_{11}=cursofinanzas
$$

La función ingreso es la siguiente (para $t>0$):
$$
Y_t=X_1 [ aX_2  X_3  (X_4+b) - cX_3X_5 + dX_6^3 + Y_{t-1}X_7^2] + eX_8  (X_4+b) + Y_{t-1}X_{9, t-1} - X_{10} \Delta X_2\\
X_9=\frac{Y_t(1+gX_{11})}{h \max(Y_t)}
$$
asd

